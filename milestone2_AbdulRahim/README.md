# Mini IDS/IPS

A lightweight Intrusion Detection and Prevention System (IDS/IPS) built with Python. This tool uses PyShark to analyze network packets from either a pcap file or a live capture, applying a set of simple detectors to identify suspicious activity. The generated logs are then processed by a mini-SIEM for basic analysis and alerting.

This project is designed to be a simple, easy-to-understand IDS/IPS that can be used for educational purposes or as a starting point for a more advanced system.

## Features

-   **Command-line interface:** Easy to use and scriptable.
-   **PCAP and live capture:** Analyze recorded traffic or monitor a live network interface.
-   **Simple detectors:** Includes detectors for suspicious DNS names, ARP spoofing, ICMP floods, and HTTP keyword matching.
-   **JSONL logging:** Clean, structured logs for both detections and operational messages.
-   **Mini-SIEM:** A small SIEM to analyze logs and generate alerts.

## Getting Started

### Prerequisites

-   **Python 3.10+:** [Download Python](https://www.python.org/downloads/)
-   **Wireshark with TShark:** TShark must be in your system's PATH. [Download Wireshark](https://www.wireshark.org/download.html)
-   **Npcap (for Windows live capture):** [Download Npcap](https://npcap.com/#download)

### Installation

1.  Clone the repository:
    ```bash
    git clone https://github.com/your-username/mini-ids-ips.git
    cd mini-ids-ips
    ```
2.  Create and activate a virtual environment:
    ```powershell
    python -m venv .venv
    .\.venv\Scripts\Activate.ps1
    ```
3.  Install the required dependencies:
    ```bash
    pip install -r requirements.txt
    ```

### Usage

#### Analyze a PCAP file

To analyze the provided DNS pcap file:

```powershell
python -m idsips.agent.cli pcap --pcap .\pcaps\dns_examples.pcapng
```

This will process the pcap file and generate logs in the `logs/` directory.

#### Live Capture (Dry Run)

To test the live capture functionality without actually sniffing packets:

```powershell
python -m idsips.agent.cli live --iface lo --dry-run
```

Press `Ctrl+C` to stop the capture.

#### Live Capture (Real)

To perform a real live capture, specify your network interface and omit the `--dry-run` flag. **Note:** This may require administrator privileges.

```powershell
python -m idsips.agent.cli live --iface <your_interface_name>
```

#### Running the ARP Spoofing Detector

To run the ARP spoofing detector, you'll need a pcap file containing ARP traffic. You can create one using Wireshark or use an existing one.

```powershell
python -m idsips.agent.cli pcap --pcap .\pcaps\arp_spoof.pcapng
```

#### Running the ICMP Flood Detector

To run the ICMP flood detector, you can either use a pcap file with a high rate of ICMP packets or run a live capture while generating ICMP traffic (e.g., using `ping -f`).

```powershell
python -m idsips.agent.cli live --iface <your_interface_name>
```

#### Using a Different Configuration File

You can use a different configuration file by specifying the `--config` option.

```powershell
python -m idsips.agent.cli pcap --pcap .\pcaps\dns_examples.pcapng --config my_config.yaml
```

#### Piping the SIEM Output

The mini-SIEM prints its output to the console, which means you can pipe it to other tools for further analysis. For example, you can use `grep` to filter the output.

```powershell
python -m idsips.siem.mini_siem --timeline | grep "2023-10-27"
```

## Configuration

The main configuration is in `config.yaml`. Here you can adjust settings such as the default interface, pcap file, and rule thresholds.

-   `capture.iface`: Default network interface for live capture.
-   `capture.pcap`: Default pcap file for analysis.
-   `rules`: Enable or disable specific detectors.
-   `thresholds`: Adjust the sensitivity of the detectors.

## Detectors

-   **DNS Suspicious Names (`DNS_SUSPICIOUS`):** Flags long domain labels, long FQDNs, or high entropy names.
-   **ARP Multi-MAC (`ARP_MULTIMAC`):** Detects if a single IP address is associated with multiple MAC addresses within a time window.
-   **ICMP Rate (`ICMP_RATE`):** Triggers if the rate of ICMP packets from a single source exceeds a threshold.
-   **HTTP Keyword (`HTTP_KEYWORD`) [optional]:** Searches for specific keywords in the host and URI of HTTP requests.

## Logging

-   `logs/detections.jsonl`: Detection events.
-   `logs/ops.jsonl`: Operational messages (e.g., start/stop events).
-   `logs/alerts.jsonl`: Alerts generated by the mini-SIEM.

## Mini-SIEM

The mini-SIEM can be used to analyze the detection logs and generate alerts.

To view rule statistics:

```powershell
python -m idsips.siem.mini_siem --rule-stats
```

To view a timeline of events:

```powershell
python -m idsips.siem.mini_siem --timeline
```

To view the top talkers:

```powershell
python -m idsips.siem.mini_siem --top
```

The SIEM also includes correlation logic to detect high-volume attacks and repeated rule firings.

## Testing

A simple test script is included to verify the basic functionality of the agent and SIEM.

```powershell
python .\scripts\run_tests.py
```

## Acknowledgements

-   This project uses [PyShark](https://kiminewt.github.io/pyshark/) for packet decoding and [PyYAML](https://pyyaml.org/) for configuration.
